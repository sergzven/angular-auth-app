import{A as g,K as p,U as u,X as d,o as i,p as l,u as c,xa as U}from"./chunk-I7PFEBLH.js";var n=1500,m="auth_token",h="users",E=class a{currentUser=U(null);constructor(){let e=this.getToken();if(e){let r=JSON.parse(atob(e));this.getUserByEmail(r.email)}}getUsers(){let e=localStorage.getItem(h);return e?JSON.parse(e):[]}saveUsers(e){localStorage.setItem(h,JSON.stringify(e))}signup(e){let r=this.getUsers();if(r.find(t=>t.email===e.email)){let t=l(()=>new Error("User already exists"));return g(n).pipe(u(()=>alert("User already exists.")),c(s=>t))}return r.push(e),this.saveUsers(r),i({message:"Signup successful"}).pipe(p(n))}login(e,r){let s=this.getUsers().find(o=>o.email===e&&o.password===r);if(!s){let o=l(()=>new Error("Invalid credentials"));return g(n).pipe(u(()=>alert("Wrong email or password.")),c(y=>o))}this.currentUser.set(s);let S={email:s.email,roles:s.roles,exp:Date.now()+3600*1e3},f=btoa(JSON.stringify(S));return localStorage.setItem(m,f),i({token:f}).pipe(p(n))}logout(){localStorage.removeItem(m),this.currentUser.set(null)}getToken(){return localStorage.getItem(m)}isLoggedIn(){let e=this.getToken();return!!e&&!this.isTokenExpired(e)}getUserByEmail(e){let t=this.getUsers().find(s=>s.email===e);t&&this.currentUser.set(t)}getUserRoles(){let e=this.getToken();return e?JSON.parse(atob(e)).roles:[]}isTokenExpired(e){let r=JSON.parse(atob(e));return Date.now()>r.exp}static \u0275fac=function(r){return new(r||a)};static \u0275prov=d({token:a,factory:a.\u0275fac,providedIn:"root"})};export{E as a};
